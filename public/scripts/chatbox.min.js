let chatDef;function getNewMessages(){let e=document.getElementById("csrf_name").value,t=document.getElementById("csrf_value").value,s=document.querySelector(chatDef.shoutsContainer),o=document.querySelectorAll(chatDef.chatScrollEl),a=o[o.length-1];B.ajax({method:"POST",url:ajaxUrl,data:{module:"chatbox",route:"check",lastShout:a.getAttribute("data-sb-id"),csrf_name:e,csrf_value:t},dataType:"json",success:function(e){document.getElementById("csrf_name").value=e.csrf.csrf_name,document.getElementById("csrf_value").value=e.csrf.csrf_value,"no new shouts"!=e.chatbox[0]&&(e.chatbox.forEach(function(e){B.appendHtml(s,e)}),scrollDown()),setTimeout(function(){getNewMessages()},3e4)}})}function chatboxPrinter(e){B.prependHtml(chatDef.shoutsContainer,e)}function chatboxNewsPrinter(e){B.appendHtml(chatDef.shoutsContainer,e)}function setCsrf(e,t){document.getElementById(e).value=t}function scrollDown(){setTimeout(function(){let e=0;document.querySelectorAll(chatDef.chatScrollEl).forEach(function(t,s){e+=parseInt(B.getHeight(t))}),e+="",document.querySelector(chatDef.divChatbox).scroll({top:e+20,behavior:"smooth"})},500)}class Chatbox{constructor(e){this.chatScrollEl=e.chatScrollEl,this.divChatbox=e.divChatbox,this.shoutsContainer=e.shoutsContainer,this.shoitItemList=e.shoitItemList,this.shoutContent=e.shoutContent,this.chatboxList=e.chatboxList,this.chatOffset=0}loadMoreShouts(){let e=document.getElementById("csrf_name").value,t=document.getElementById("csrf_value").value;B.ajax({method:"POST",url:ajaxUrl,data:{module:"chatbox",route:"load",offset:this.chatOffset,csrf_name:e,csrf_value:t},dataType:"json",success:function(e){setCsrf("csrf_name",e.csrf.csrf_name),setCsrf("csrf_value",e.csrf.csrf_value),"no more shouts"!=e.chatbox&&(e.chatbox.reverse(),e.chatbox.forEach(function(e){B.prependHtml(document.querySelector(chatDef.shoutsContainer),e)}))}}),++this.chatOffset}postShout(){let e=document.getElementById("csrf_name").value,t=document.getElementById("csrf_value").value,s=document.getElementById(this.shoutContent),o=document.querySelector(this.shoutsContainer);B.ajax({method:"POST",url:ajaxUrl,data:{module:"chatbox",route:"post",shout:s.value,csrf_name:e,csrf_value:t},dataType:"json",success:function(e){setCsrf("csrf_name",e.csrf.csrf_name),setCsrf("csrf_value",e.csrf.csrf_value),B.appendHtml(o,e.shout),s.setAttribute("value",""),s.value=""}}).then(()=>{scrollDown()})}init(){chatDef=this,getNewMessages(),scrollDown()}editMessage(){let e=document.getElementById("csrf_name").value,t=document.getElementById("csrf_value").value,s=document.getElementById("chat-edit-input").value,o=document.getElementById("chat-edit-id").value;B.ajax({method:"POST",url:ajaxUrl,data:{module:"chatbox",route:"edit",shout_content:s,shout_id:o,csrf_name:e,csrf_value:t},dataType:"json",success:function(e){setCsrf("csrf_name",e.csrf.csrf_name),setCsrf("csrf_value",e.csrf.csrf_value),document.getElementById("shout-content-"+o).innerHTML=s,console.log(o+"   "+s),B.hide("#chatMessageEdit")}})}}