function scrollDown(){setTimeout(function(){var t=0;$("div li").each(function(a,e){t+=parseInt($(this).height())}),t+="",$("div.chatbox").animate({scrollTop:t})},500)}function chatboxPrinter(t){$("#shouts").prepend(t),$(".list-group-item").fadeIn("slow")}function chatboxNewsPrinter(t){$("#shouts").append(t),$(".list-group-item").fadeIn("slow")}function loadMoreShouts(t){var a=$("#csrf_name").val(),e=$("#csrf_value").val();$.ajax({type:"POST",url:urlForLoadMessages,data:{offset:t,csrf_name:a,csrf_value:e},dataType:"json",success:function(t){$("#csrf_name").val(t.csrf.csrf_name),$("#csrf_value").val(t.csrf.csrf_value),"no more shouts"!=t.chatbox&&(t.chatbox.reverse(),t.chatbox.forEach(chatboxPrinter))}})}function postShout(){var t=$("#csrf_name").val(),a=$("#csrf_value").val();$.ajax({type:"POST",url:urlForChatbox,data:{shout:$("#shout-content").val(),csrf_name:t,csrf_value:a},dataType:"json",success:function(t){$("#csrf_name").val(t.csrf.csrf_name),$("#csrf_value").val(t.csrf.csrf_value),$("#shouts").append(t.shout),$("#shout-content").attr("value",""),$("#shout-content").val(""),scrollDown()}})}function getNewMessages(){var t=$("#csrf_name").val(),a=$("#csrf_value").val();$.ajax({type:"POST",url:urlForChatboxNew,data:{lastShout:$(".chatbox-li").last().val(),csrf_name:t,csrf_value:a},dataType:"json",success:function(t){$("#csrf_name").val(t.csrf.csrf_name),$("#csrf_value").val(t.csrf.csrf_value),"no new shouts"!=t.chatbox[0]&&(t.chatbox.forEach(chatboxNewsPrinter),scrollDown()),setTimeout(function(){getNewMessages()},5e3)}})}function editMessage(t){var a=$("#csrf_name").val(),e=$("#csrf_value").val();$.ajax({type:"POST",url:urlForEditMessage,data:{shout_content:$("#shout_edit_content").val(),shout_id:$("#shout_edit_id").val(),csrf_name:a,csrf_value:e},dataType:"json",success:function(t){$("#csrf_name").val(t.csrf.csrf_name),$("#csrf_value").val(t.csrf.csrf_value),$("#shout-content-"+t.id).html(t.content),$("#chatMessageEdit").modal("hide")}})}$(document).ready(function(){$("#button-chatbox").click(function(){postShout()}),$("#shout-content").keypress(function(t){if(13==t.which)return $("#button-chatbox").click(),!1}),scrollDown();var t=0;$(".chatbox.card-body").scroll(function(){0==$(this).scrollTop()&&(loadMoreShouts(++t),$("#scrollHere").length&&(setTimeout(function(){$("div.chatbox").animate({scrollTop:$("#scrollHere").offset().top},"fast")},250),$("#scrollHere").remove()))}),getNewMessages(),$("span").click(function(t){var a=t.target.attributes["data-content-id"].value;$("#shout_edit_id").val(a),$("#shout_edit_content").val($("#shout-content-"+a).html()),$("#button-chatbox-edit").click(function(){editMessage(a)})})});